<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CoPL</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Interpreter options -->
    <div class="options-panel">
        <h3>Options</h3>
        <label><input type="checkbox" id="toggleArithmetic">Arithmetic Expressions</label><br>
        <label><input type="checkbox" id="toggleConditionals">Conditionals</label><br>
        <label><input type="checkbox" id="toggleLet">Identifiers (Let + Id)</label><br>
        <div class="radio-group let">
            Id<br>
            <label><input type="radio" name="substitution" id="toggleSubstNaive" checked> Naive Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleSubstSimple"> Simple
                Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleSubstCaptureAvoiding"> Capture-Avoiding
                Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleEnv"> Environment</label><br>
        </div>
        <div class="radio-group let">
            Substitution<br>
            <label><input type="radio" name="letEval" id="toggleLetEager"> Eager</label><br>
            <label><input type="radio" name="letEval" id="toggleLetLazy" checked> Lazy</label><br>
        </div>
        <label><input type="checkbox" id="toggleFunctions">Functions</label><br>
        <div class="radio-group functions">
            <label><input type="radio" name="functions" id="toggleFirstOrder" checked> First-Order</label><br>
            <label><input type="radio" name="functions" id="toggleHigherOrder"> Higher-Order</label><br>
            <label><input type="radio" name="functions" id="toggleFirstClass"> First-Class</label><br>
        </div>
        <div class="radio-group functions">
            Call-by<br>
            <label><input type="radio" name="functionsEval" id="toggleCallByValue"> Value</label><br>
            <label><input type="radio" name="functionsEval" id="toggleCallByName" checked> Name</label><br>
        </div>
        <div class="radio-group functions">
            Scope<br>
            <label><input type="radio" name="functionsScope" id="toggleScopeStatic" checked> Static</label><br>
            <label><input type="radio" name="functionsScope" id="toggleScopeDynamic"> Dynamic</label><br>
        </div>
    </div>

    <div class="code-section">
        <h2>Values</h2>
        <div class="code-container">
            <div>abstract class Value</div>
            <div class="i1">case class VNum(n: Int) extends Value</div>
            <div class="i1 first-class-functions">case class VFun(param: String, body: Expr) extends Value</div>
        </div>

        <h2>AST</h2>
        <div class="code-container">
            <div>abstract class Expr</div>
            <div class="i1">case class Num(n: Int) extends Expr</div>
            <div class="i1 arithmetic">case class Add(lhs: Expr, rhs: Expr) extends Expr</div>
            <div class="i1 arithmetic">case class Sub(lhs: Expr, rhs: Expr) extends Expr</div>
            <div class="i1 conditionals">case class If0(c: Expr, t: Expr, f: Expr) extends Expr</div>
            <div class="i1 let">case class Let(name: String, namedExpr: Expr, body: Expr) extends Expr</div>
            <div class="i1 let">case class Id(name: String) extends Expr</div>
            <div class="i1 functions">case class App(<span class="first-class-functions-inline">funExpr:
                    Expr</span><span class="not-first-class-functions-inline">funName: String</span>, argExpr: Expr)
                extends Expr</div>
        </div>

        <h2>Interpreter</h2>
        <div class="code-container">
            <div>def interp(expr: Expr<span class="not-first-class-functions-inline">, funDefs: Map[String,
                    FunDef]</span><span class="environment-inline">, env: Env</span>): Value =
                expr match
                {</div>
            <div class="i1">case Num(n) => n</div>
            <div class="i1 arithmetic">case Add(lhs, rhs) => interp(lhs<span class="not-first-class-functions-inline">,
                    funDefs</span><span class="environment-inline">, env</span>)
                + interp(rhs<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">,
                    env</span>)</div>
            <div class="i1 arithmetic">case Sub(lhs, rhs) => interp(lhs<span class="not-first-class-functions-inline">,
                    funDefs</span><span class="environment-inline">,
                    env</span>)
                - interp(rhs<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">,
                    env</span>)</div>
            <div class="i1 conditionals">case If0(c, t, f) => if (interp(c<span
                    class="not-first-class-functions-inline">,
                    funDefs</span><span class="environment-inline">,
                    env</span>) == 0)</div>
            <div class="i2 conditionals">interp(t<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">,
                    env</span>) else interp(f<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">,
                    env</span>)</div>
            <div class="i1 let">case Id(name) => <span class="substitutionNaive-inline">sys.error(s"found unbound id
                    $name")</span><span class="environment-inline">env(name)</span></div>
            <div class="i1 let">case Let(name, namedExpr, body) =></div>
            <div class="i2 substitutionNaive">val body = subst(body,
                name, <span class="eager">Num(interp(</span>namedExpr<span class="eager-functions-inline">,
                    funDefs</span><span class="eager">))</span>)</div>
            <div class="i2 environment">val newEnv = env + (id -> interp(expr,
                funDefs, env))</div>
            <div class="i2 let">interp(body<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">, newEnv</span>)</div>
            <div class="i1 functions">case App(<span class="first-class-functions-inline">funExpr</span><span
                    class="not-first-class-functions-inline">funName</span>, argExpr) => <span
                    class="first-class-functions-inline">interp(funExpr)</span><span
                    class="not-first-class-functions-inline">funDefs(funName)</span> match {</div>
            <div class="i2 functions">case <span class="first-class-functions-inline">VFun</span><span
                    class="not-first-class-functions-inline">FunDef</span>(param, body) =></div>

            <div class="i3 substitutionNaive">val body = subst(body,
                param, <span class="eager">Num(interp(</span>argExpr<span class="eager-functions-inline">,
                    funDefs</span><span class="eager">))</span>)</div>
            <div class="i3 environment">val funEnv = <span class="dynamicScope">env + </span><span
                    class="staticScope">Map</span>(param -> interp(argExpr, funDefs, env))</div>

            <div class="i3 functions">interp(body<span class="not-first-class-functions-inline">, funDefs</span><span
                    class="environment-inline">, funEnv</span>)</div>
            <div class="i2 first-class-functions">case v1 => error(s"Expected funct value but got $v1")</div>
            <div class="i1 functions">}</div>
            <div>}</div>
        </div>

        <h2 class="substitutionNaive">Substitute</h2>
        <div class="code-container substitutionNaive">
            <div>// Substitutes "substId" with "value" in "expr"</div>
            <div>// The resulting expression contains no free instances of the 2nd argument.</div>
            <div>def subst(expr: Expr, substId: String, value: Expr): Expr = expr match {</div>
            <div class="i1">case Num(_) => expr</div>
            <div class="i1 arithmetic">case Add(lhs, rhs) => Add(subst(lhs, substId, value), subst(rhs,
                substId, value))
            </div>
            <div class="i1 arithmetic">case Sub(lhs, rhs) => Sub(subst(lhs, substId, value), subst(rhs,
                substId, value))
            </div>
            <div class="i1 conditionals">case If0(test, thenBody, elseBody) =></div>
            <div class="i2 conditionals">If0(subst(test, substId, value), subst(thenBody, substId,
                value), subst(elseBody, substId, value))
            </div>
            <div class="i1">case Id(name) => if substId == name then value else expr</div>
            <div class="i1">case Let(name, namedExpr, body) =></div>
            <div class="i2">val substNamedExpr = subst(namedExpr, substId, value)</div>
            <div class="i2 substitutionSimple">if name == substId then</div>
            <div class="i3 substitutionSimple">Let(name, substNamedExpr,
                body)</div>
            <div class="i2 substitutionSimple">else</div>
            <div class="i2"><span class="substitutionSimple-inline">&nbsp;&nbsp;</span>Let(name,
                substNamedExpr, subst(body, substId, value))</div>
            <div class="i1 functions">case App(<span class="first-class-functions-inline">funExpr</span><span
                    class="not-first-class-functions-inline">funName</span>, argExpr) =></div>
            <div class="i2 functions">val newArg = subst(argExpr, substId, value)</div>
            <div class="i2 first-class-functions">val newFunExpr = subst(funExpr, substId, value)</div>
            <div class="i2 functions">App(<span class="first-class-functions-inline">newFunExpr</span><span
                    class="not-first-class-functions-inline">funName</span>, newArg)</div>
            <div class="i1">case Fun(param, body) =></div>


            <div class="i2 substitutionSimple">if param == substId then</div>
            <div class="i3 substitutionSimple">Fun(param, body)</div>
            <div class="i2 substitutionSimple">else<span class="substitutionCaptureAvoiding-inline"> if
                    !freeVariables(value).contains(param) then</span></div>
            <div class="i2"><span class="substitutionSimple-inline">&nbsp;&nbsp;</span>Fun(param, subst(body, substId,
                value))</div>
            <div class="i2 substitutionCaptureAvoiding">else</div>
            <div class="i3 substitutionCaptureAvoiding">val potentialConflicts = freeVariables(value) union
                freeVariables(body)
            </div>
            <div class="i3 substitutionCaptureAvoiding">val freshId = Id(freshName(param, potentialConflicts))</div>
            <div class="i3 substitutionCaptureAvoiding">val alphaRenamed = subst(body, param, freshId)</div>
            <div class="i3 substitutionCaptureAvoiding">Fun(freshId.name, subst(alphaRenamed, substId, value))</div>
            <div>}</div>
        </div>
    </div>
</body>

<footer class="not-implemented">
    Not Implemented!
</footer>

</html>