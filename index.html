<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CoPL</title>
    <style>
        body {
            font-family: Consolas, "Courier New", monospace;
            background-color: #f4f4f4;
            padding: 20px;
        }

        .i1 {
            margin-left: 2ch;
        }

        .i2 {
            margin-left: 4ch;
        }

        .i3 {
            margin-left: 6ch;
        }

        .i4 {
            margin-left: 8ch;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Indentation for radio buttons */
        .radio-group {
            margin-left: 25px;
        }

        .code-section {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .options-panel {
            width: 250px;
            background-color: #ddd;
            padding: 20px;
            border-left: 1px solid #bbb;
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            overflow-y: auto;
        }

        .code-container {
            background-color: #eee;
            border: 1px solid #ccc;
            padding: 15px;
            line-height: 1.5;
            margin-top: 20px;
        }

        .arithmetic,
        .conditionals,
        .let {
            opacity: 0;
        }

        .eager,
        .substitute,
        .substitutionSimple,
        .substitutionSimpleSpaces {
            display: none;
        }


        /* When the inline toggle is checked, show inline text */
        body:has(#toggleArithmetic:checked) .arithmetic {
            opacity: 1;
            animation: highlight 10s forwards;
        }

        /* When the inline toggle is checked, show inline text */
        body:has(#toggleConditionals:checked) .conditionals {
            opacity: 1;
            animation: highlight 10s forwards;
        }

        /* When the inline toggle is checked, show inline text */
        body:has(#toggleLet:checked) .let {
            opacity: 1;
            animation: highlight 10s forwards;
        }

        /* When the inline toggle is checked, show inline text */
        body:has(#toggleEager:checked) .eager {
            display: inline;
            animation: highlight 10s forwards;
        }

        body:has(#toggleLet:checked) .substitute {
            display: block;
            animation: highlight 10s forwards;
        }

        body:has(#toggleEnv:checked) .substitute {
            display: none;
            animation: highlight 10s forwards;
        }

        body:has(#toggleSubstSimple:checked) .substitutionSimple {
            display: block;
            animation: highlight 10s forwards;
        }

        body:has(#toggleSubstSimple:checked) .substitutionSimpleSpaces {
            display: inline;
        }

        /* Keyframes animation: start green and transition to black */
        @keyframes highlight {
            0% {
                color: rgb(8, 247, 8);
            }

            100% {
                color: black;
            }
        }
    </style>
</head>

<body>
    <div class="options-panel">
        <h3>Options</h3>
        <label><input type="checkbox" id="toggleArithmetic">Arithmetic Expressions</label><br>
        <label><input type="checkbox" id="toggleConditionals">Conditionals</label><br>
        <label><input type="checkbox" id="toggleLet">Identifiers (Let + Id)</label><br>
        <div class="radio-group let">
            Id<br>
            <label><input type="radio" name="substitution" id="toggleSubstNaive" checked> Naive Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleSubstSimple" checked> Simple
                Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleSubstCaptureAvoiding" checked> Capture-Avoiding
                Substitution</label><br>
            <label><input type="radio" name="substitution" id="toggleEnv"> Environment</label><br>
        </div>
        <div class="radio-group let">
            Evaluation<br>
            <label><input type="radio" name="eagerEval" id="toggleEager" checked> Eager</label><br>
            <label><input type="radio" name="eagerEval" id="toggleLazy"> Lazy</label><br>
        </div>
    </div>

    <div class="code-section">
        <h2>Value</h2>
        <div class="code-container">
            <div>type Value = Int</div>
        </div>

        <h2>Class</h2>
        <div class="code-container">
            <div>abstract class Expr</div>
            <div class="i1">case class Num(n: Int) extends Expr</div>
            <div class="i1 arithmetic">case class Add(lhs: Expr, rhs: Expr) extends Expr</div>
            <div class="i1 arithmetic">case class Sub(lhs: Expr, rhs: Expr) extends Expr</div>
            <div class="i1 conditionals">case class If0(c: Expr, t: Expr, f: Expr) extends Expr</div>
            <div class="i1 let">case class Let(name: String, bound: Expr, body: Expr) extends Expr</div>
            <div class="i1 let">case class Id(name: String) extends Expr</div>
        </div>

        <h2>Interpreter</h2>
        <div class="code-container">
            <div>def interp(expr: Expr): Value = expr match {</div>
            <div class="i1">case Num(n) => n</div>
            <div class="i1 arithmetic">case Add(lhs, rhs) => interp(lhs) + interp(rhs)</div>
            <div class="i1 arithmetic">case Sub(lhs, rhs) => interp(lhs) - interp(rhs)</div>
            <div class="i1 conditionals">case If0(c, t, f) => if (interp(c) == 0)</div>
            <div class="i2 conditionals">interp(t) else interp(f)</div>
            <div class="i1 let">case Id(name) => sys.error(s"found unbound id $name")</div>
            <div class="i1 let">case Let(boundId, namedExpr, boundExpr) => interp(subst(boundExpr,
                boundId, <span class="eager">Num(interp(</span>namedExpr<span class="eager">)</span>)))</div>
            <div>}</div>
        </div>

        <h2 class="substitute">Substitute</h2>
        <div class="code-container substitute">
            <div>// Substitutes "substId" with "value" in "expr"</div>
            <div>// The resulting expression contains no free instances of the 2nd argument.</div>
            <div>def subst(expr: Expr, substId: String, value: Expr): Expr = expr match {</div>
            <div class="i1">case Num(_) => expr</div>
            <div class="i1 arithmetic">case Add(lhs, rhs) => Add(subst(lhs, substId, value), subst(rhs,
                substId, value))
            </div>
            <div class="i1 arithmetic">case Sub(lhs, rhs) => Sub(subst(lhs, substId, value), subst(rhs,
                substId, value))
            </div>
            <div class="i1 conditionals">case If0(test, thenBody, elseBody) =></div>
            <div class="i2 conditionals">If0(subst(test, substId, value), subst(thenBody, substId,
                value), subst(elseBody, substId, value))
            </div>
            <div class="i1 let">case Id(name) => if substId == name then value else expr</div>
            <div class="i1 let">case Let(boundId, namedExpr, boundExpr) =></div>
            <div class="i2 let">val substNamedExpr = subst(namedExpr, substId, value)</div>
            <div class="i2 let substitutionSimple">if boundId == substId then</div>
            <div class="i3 let substitutionSimple">Let(boundId, substNamedExpr,
                boundExpr)</div>
            <div class="i2 let substitutionSimple">else</div>
            <div class="i2 let"><span class="substitutionSimpleSpaces">&nbsp;&nbsp;</span>Let(boundId,
                substNamedExpr, subst(boundExpr, substId, value))</div>
            <div class="i1 i1">case App(funName, argExprs) =></div>
            <div class="i1 i2">val newArgs = argExprs.map(ex => subst(ex, substId, value))</div>
            <div class="i1 i2">App(funName, newArgs)</div>
            <div>}</div>
        </div>
    </div>
</body>

</html>